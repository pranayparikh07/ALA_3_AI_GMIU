<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NovaChat – AI Assistant</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tailwindcss/typography@0.5.9/dist/typography.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <style>
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #1f2937;
    }
    ::-webkit-scrollbar-thumb {
      background: #4b5563;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #6b7280;
    }
    
    /* Mobile-first responsive improvements */
    .sidebar {
      transition: transform 0.3s ease-in-out;
    }
    
    /* Mobile styles */
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        width: 280px; /* Slightly wider on mobile for better touch targets */
      }
      .sidebar.open {
        transform: translateX(0);
      }
      
      /* Ensure main content doesn't get too cramped */
      .main-content {
        min-height: 100vh;
      }
      
      /* Better touch targets on mobile */
      button {
        min-height: 44px;
        min-width: 44px;
      }
      
      /* Improved input area for mobile */
      .input-container {
        padding: 12px;
      }
      
      /* Chat bubbles responsive sizing */
      .chat-bubble {
        max-width: 85%;
      }
    }
    
    /* Tablet styles */
    @media (min-width: 769px) and (max-width: 1024px) {
      .sidebar {
        width: 240px;
      }
      
      .chat-bubble {
        max-width: 70%;
      }
    }
    
    /* Small mobile devices */
    @media (max-width: 480px) {
      .sidebar {
        width: 100%;
      }
      
      .chat-bubble {
        max-width: 90%;
      }
      
      /* Smaller padding on very small screens */
      .chat-container {
        padding: 8px 12px;
      }
    }
    
    /* Overlay for mobile sidebar */
    .sidebar-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 15;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
    }
    
    .sidebar-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    
    /* Ensure text is readable on all screen sizes */
    @media (max-width: 768px) {
      .text-responsive {
        font-size: 14px;
        line-height: 1.5;
      }
    }
  </style>
</head>
<body class="bg-gray-950 text-white min-h-screen flex font-sans">
  <!-- Sidebar Overlay for Mobile -->
  <div id="sidebarOverlay" class="sidebar-overlay md:hidden"></div>
  
  <!-- Sidebar -->
  <aside class="sidebar fixed inset-y-0 left-0 w-64 bg-gray-900 border-r border-gray-800 flex flex-col z-20 md:static md:translate-x-0">
    <div class="p-4 border-b border-gray-800 flex items-center justify-between">
      <div>
        <h1 class="text-xl font-bold text-cyan-400">NovaChat</h1>
        <p class="text-sm text-gray-400">AI Assistant</p>
      </div>
      <button id="closeSidebar" class="md:hidden text-gray-400 hover:text-white">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    <nav class="flex-1 overflow-y-auto p-4 space-y-2 text-sm">
      <p class="text-gray-400 uppercase text-xs mb-2">Quick Prompts</p>
      <button onclick="usePrompt('Summarize an article')"
              class="w-full text-left px-3 py-3 rounded-md bg-gray-800 hover:bg-gray-700 transition-colors duration-200 touch-target">
        Summarize an article
      </button>
      <button onclick="usePrompt('Generate 5 creative startup ideas')"
              class="w-full text-left px-3 py-3 rounded-md bg-gray-800 hover:bg-gray-700 transition-colors duration-200 touch-target">
        Startup ideas
      </button>
      <button onclick="usePrompt('Explain recursion simply')"
              class="w-full text-left px-3 py-3 rounded-md bg-gray-800 hover:bg-gray-700 transition-colors duration-200 touch-target">
        Explain recursion
      </button>
      <button onclick="usePrompt('Latest cybersecurity threats')"
              class="w-full text-left px-3 py-3 rounded-md bg-gray-800 hover:bg-gray-700 transition-colors duration-200 touch-target">
        Cybersecurity trends
      </button>
      <button onclick="usePrompt('Write a Python factorial function')"
              class="w-full text-left px-3 py-3 rounded-md bg-gray-800 hover:bg-gray-700 transition-colors duration-200 touch-target">
        Python factorial code
      </button>
    </nav>
    <div class="p-4 border-t border-gray-800 text-xs text-gray-500">
      © 2025 NovaChat Inc.
    </div>
  </aside>

  <!-- Main Chat Area -->
  <main class="flex-1 flex flex-col main-content">
    <!-- Header -->
    <header class="p-3 sm:p-4 border-b border-gray-800 flex items-center justify-between bg-gray-900">
      <div class="flex items-center space-x-3">
        <button id="openSidebar" class="md:hidden text-gray-400 hover:text-white p-2 rounded-md hover:bg-gray-800 transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
        <h2 class="text-lg sm:text-xl font-semibold text-white">Chat</h2>
      </div>
      <span class="text-xs text-gray-400 hidden sm:inline">Professional SaaS Mode</span>
    </header>

    <!-- Chatbox -->
    <div id="chatbox" class="flex-1 overflow-y-auto chat-container p-3 sm:p-4 lg:p-6 space-y-3 sm:space-y-4 bg-gray-950 prose prose-invert max-w-none">
      <div class="text-center text-gray-500 text-sm">Start a conversation with NovaChat 🚀</div>
    </div>

    <!-- Input area -->
    <div class="border-t border-gray-800 input-container p-3 sm:p-4">
      <div class="flex items-stretch bg-gray-900 border border-gray-700 rounded-lg overflow-hidden">
        <input id="userInput" 
               type="text" 
               placeholder="Ask NovaChat anything..." 
               class="flex-1 bg-transparent text-white px-3 sm:px-4 py-3 focus:outline-none placeholder-gray-500 text-sm sm:text-base">
        <button onclick="sendMessage()" 
                class="bg-cyan-500 hover:bg-cyan-600 active:bg-cyan-700 text-black font-bold px-4 sm:px-5 py-3 transition-colors duration-200 min-w-[50px] flex items-center justify-center">
          <span class="text-lg">➤</span>
        </button>
      </div>
      <p class="mt-2 text-xs text-gray-500 text-center text-responsive">
        NovaChat may display AI-generated content. Use wisely.
      </p>
    </div>
  </main>

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    const input = document.getElementById("userInput");
    const chatbox = document.getElementById("chatbox");
    const openSidebar = document.getElementById("openSidebar");
    const closeSidebar = document.getElementById("closeSidebar");
    const sidebar = document.querySelector(".sidebar");
    const sidebarOverlay = document.getElementById("sidebarOverlay");

    // Toggle sidebar for mobile
    openSidebar.addEventListener("click", () => {
      sidebar.classList.add("open");
      sidebarOverlay.classList.add("active");
      document.body.style.overflow = "hidden"; // Prevent background scroll
    });
    
    const closeSidebarFunction = () => {
      sidebar.classList.remove("open");
      sidebarOverlay.classList.remove("active");
      document.body.style.overflow = ""; // Restore scroll
    };
    
    closeSidebar.addEventListener("click", closeSidebarFunction);
    sidebarOverlay.addEventListener("click", closeSidebarFunction);

    // Rotating placeholder prompts
    const placeholderPrompts = [
      "Summarize an article",
      "Generate 5 startup ideas",
      "Explain recursion like I’m 10",
      "Latest cybersecurity threats",
      "Show Python factorial code"
    ];
    let placeholderIndex = 0;
    setInterval(() => {
      input.placeholder = placeholderPrompts[placeholderIndex];
      placeholderIndex = (placeholderIndex + 1) % placeholderPrompts.length;
    }, 4000);

    // Enter-to-send
    input.addEventListener("keypress", function(event) {
      if (event.key === "Enter") {
        event.preventDefault();
        sendMessage();
      }
    });

    function usePrompt(text) {
      input.value = text;
      sendMessage();
      // Close sidebar on mobile after selecting prompt
      if (window.innerWidth < 768) {
        closeSidebarFunction();
      }
    }

    async function sendMessage() {
      const message = input.value.trim();
      if (!message) return;

      // User bubble
      chatbox.innerHTML += `
        <div class="flex justify-end">
          <div class="bg-cyan-500 text-black px-3 sm:px-4 py-2 sm:py-3 rounded-lg chat-bubble shadow whitespace-pre-wrap text-sm sm:text-base">
            ${message}
          </div>
        </div>`;
      chatbox.scrollTop = chatbox.scrollHeight;
      input.value = "";

      // Bot placeholder
      const botBubble = document.createElement("div");
      botBubble.className = "flex justify-start";
      const span = document.createElement("div");
      span.className = "bg-gray-800 text-gray-200 px-3 sm:px-4 py-2 sm:py-3 rounded-lg chat-bubble shadow prose prose-invert text-sm";
      botBubble.appendChild(span);
      chatbox.appendChild(botBubble);

      try {
        const response = await fetch("/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message })
        });
        const data = await response.json();

        // Render Markdown
        span.innerHTML = marked.parse(data.reply);

        // Highlight code if present
        span.querySelectorAll("pre code").forEach((block) => {
          hljs.highlightElement(block);
        });

        chatbox.scrollTop = chatbox.scrollHeight;
      } catch (error) {
        span.innerHTML = "⚠️ Error fetching response.";
      }
    }
  </script>
</body>
</html>
